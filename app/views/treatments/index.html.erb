<script type="text/javascript">
  if (gon.whatsapp_action == "updated") {window.open("https://wa.me/1".concat(gon.whatsapp_num,"?text=Your treatment is updated. - CbvXStem"), '_blank');}
  else if (gon.whatsapp_action == "created") {window.open("https://wa.me/1".concat(gon.whatsapp_num,"?text=A treatment is added for you. - CbvXStem"), '_blank');}
</script>
<%# <div class = "search_table"> %>
<!--p id="notice"><%= notice %></p>-->
<div>
<h1 style="text-align: center">Treatments</h1>
<br>
</div>
<!--
<div class = "leftBar">
   <nav id="sidebar">
      <div class="sidebar-header">
         <h4><%= params[:patient_name]%> </h4>
      </div>

      <ul class="list-unstyled components">
         <p>Patient's Info</p>
         <li><%= link_to "Profile", patient_path(params[:patient_id])%></a></li>
         <li><%= link_to "Documents", user_holder_documentations_path(params[:patient_id])%></a></li>
         <li><%= link_to "Medications", user_holder_medications_path(params[:patient_id])%></a></li>
         <li><%= link_to "Treatments", user_holder_treatments_path(params[:patient_id])%></a></li>
      </ul>
   </nav>
</div>  -->
<div class="split-20-80">
  <div class="left-20"> <%= render 'shared/user_side_nav' %> </div>
  <div class="right-80">

    <div class = "right-container2">
      <table class = "table table-striped col-md-12" display="inline-block">
          <thead>
            <tr>
              <th>Provider</th>
              <th>Location</th>
              <th>Status</th>
              <th>Description</th>
              <th colspan="2">Patient Name</th>
              <th colspan="3"></th>
            </tr>
          </thead>

          <tbody>
            <% @treatments.each do |treatment| %>
              <tr>
                <td><%= treatment.provider %></td>
                <td><%= treatment.location %></td>
                <td><%= treatment.status %></td>
                <td><%= treatment.description.length > 15 ? treatment.description[0..15] + "..." : treatment.description %></td>
                <td><%= treatment.user_holder.first_name %></td>
                <td><%= treatment.user_holder.last_name %></td>
                <% if can? :read, treatment %> <td><%= link_to 'Details', [@user_holder, treatment] %></td> <% end %>
                <% if can? :update, treatment %> <td><%= link_to 'Edit', edit_user_holder_treatment_path(@user_holder, treatment) %></td><% end %>
                <% if can? :destroy, treatment %> <td><%= link_to 'Destroy', [@user_holder, treatment], method: :delete, data: { confirm: 'Are you sure?' } %></td><% end %>
              </tr>
            <% end %>
          </tbody>
        </table>

        <% #HACK:: as long as database has one record, it will be able to check the ActiveRecord %>
        <% @treatment = Treatment.all.first %>
        <% if can? :create, @treatment %>
          <button class="col-md-1.5 btn btn-success">
            <%= link_to "Add Treatment", new_user_holder_treatment_path(@user_holder) %>
          </button>
        <% end %>
    </div>
  </div>
</div>
